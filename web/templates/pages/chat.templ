package pages

import "stats-agent/web/templates/layout"
import "stats-agent/web/templates/components"
import "stats-agent/web/types"
import "github.com/google/uuid"

// Update the signature to accept the new MessageGroup slice
templ ChatPage(activeSessionID uuid.UUID, sessions []types.Session, messageGroups []types.MessageGroup) {
	@layout.Base("Chat") {
		<div class="flex h-full">
			// Sidebar
			<div class="w-72 flex-shrink-0">
				@components.SessionList(sessions, activeSessionID)
			</div>

			// Main Chat Area
			<div class="flex-1 flex flex-col">
				<div class="flex-1 flex flex-col items-center justify-center p-4 space-y-6">
					<div class="w-full max-w-4xl h-full flex flex-col">
						// Messages container
						<div id="messages" class="flex-1 overflow-y-auto p-6 space-y-6 scrollbar-thin">
							if len(messageGroups) == 0 {
								@components.WelcomeMessage()
							} else {
								// Use a simple, clean loop
								for _, group := range messageGroups {
									switch group.PrimaryRole {
									case "user":
										@components.UserMessage(group.Messages[0])
									case "agent":
										@components.AgentMessageGroup(group.Messages)
									}
								}
							}
						</div>
						// Form container
						<div class="p-6 border-t border-gray-200/50">
							@components.ChatForm(activeSessionID.String())
						</div>
					</div>
				</div>
			</div>
		</div>
	}
}